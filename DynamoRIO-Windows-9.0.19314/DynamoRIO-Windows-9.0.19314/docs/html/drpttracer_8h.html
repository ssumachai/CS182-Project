<!-- HTML header for doxygen 1.8.19-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<title>DynamoRIO: D:/a/dynamorio/dynamorio/ext/drpttracer/drpttracer.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('drpttracer_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">drpttracer.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header for DynamoRIO Intel PT Tracing Extension.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;inttypes.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__pt__metadata__t.html">_pt_metadata_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__drpttracer__output__t.html">_drpttracer_output_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:adf5b364ce02f7edc31dad432b6a7d59b"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__pt__metadata__t.html">_pt_metadata_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#adf5b364ce02f7edc31dad432b6a7d59b">pt_metadata_t</a></td></tr>
<tr class="separator:adf5b364ce02f7edc31dad432b6a7d59b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a039aa7d15f79edcbae537289181000"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__drpttracer__output__t.html">_drpttracer_output_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#a2a039aa7d15f79edcbae537289181000">drpttracer_output_t</a></td></tr>
<tr class="separator:a2a039aa7d15f79edcbae537289181000"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a7846187879de367e706edaed0293e45d"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a> { <br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45daa8ba0cc1895bd5e2fbfa143c0c109bf2">DRPTTRACER_SUCCESS</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45dab4d57a690dd5247bd71b0d0adfa67ecb">DRPTTRACER_ERROR</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45da567c1101168271a76a7b57ad55bdba36">DRPTTRACER_ERROR_INVALID_PARAMETER</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45dab09a7ff2105b8eb3b46317c253ec5e8d">DRPTTRACER_ERROR_FAILED_TO_OPEN_PERF_EVENT</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45da036841364a0e53fba420bed52ee1c5f0">DRPTTRACER_ERROR_FAILED_TO_MMAP_PERF_DATA</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45dac4d8cf608e4e2a7d6f197250bd2df691">DRPTTRACER_ERROR_FAILED_TO_MMAP_PT_DATA</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45da5810bfac6ed2c2b271e17ca1661b8bae">DRPTTRACER_ERROR_FAILED_TO_START_TRACING</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45dad3df38fd5acea95b31071a5cc33d8a41">DRPTTRACER_ERROR_FAILED_TO_STOP_TRACING</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45dac3626cf9c2740a80ca15c99e6fba493a">DRPTTRACER_ERROR_OVERWRITTEN_PT_TRACE</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45da178ccc3073b124e34ba2542ac7514061">DRPTTRACER_ERROR_FAILED_TO_READ_PT_DATA</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45da3beefda8ad4ea9aa597f6a07053c56af">DRPTTRACER_ERROR_OVERWRITTEN_SIDEBAND_DATA</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45da6cf6c48b7fa9c81b83444d022ac34308">DRPTTRACER_ERROR_FAILED_TO_READ_SIDEBAND_DATA</a>
<br />
 }</td></tr>
<tr class="separator:a7846187879de367e706edaed0293e45d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab099a83052a5a8b244083b57ddffcbc5"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5">drpttracer_tracing_mode_t</a> { <br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5a2a5a1e4a865cb2c334cf8419b2ec56fa">DRPTTRACER_TRACING_ONLY_USER</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5a567592a17aff204f5a4b194f66eaed0a">DRPTTRACER_TRACING_ONLY_KERNEL</a>, 
<br />
&#160;&#160;<a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5a9d97d6e409ada6de57b31fe55aa0e4db">DRPTTRACER_TRACING_USER_AND_KERNEL</a>
<br />
 }</td></tr>
<tr class="separator:ab099a83052a5a8b244083b57ddffcbc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2ce2d81e3de5e6969eb2742f1eab15d2"><td class="memItemLeft" align="right" valign="top">DR_EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#a2ce2d81e3de5e6969eb2742f1eab15d2">drpttracer_init</a> (void)</td></tr>
<tr class="separator:a2ce2d81e3de5e6969eb2742f1eab15d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85f7b141497601e4205789e490ca3535"><td class="memItemLeft" align="right" valign="top">DR_EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#a85f7b141497601e4205789e490ca3535">drpttracer_exit</a> (void)</td></tr>
<tr class="separator:a85f7b141497601e4205789e490ca3535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0df98e25ae870fddf34da980f1801f3a"><td class="memItemLeft" align="right" valign="top">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#a0df98e25ae870fddf34da980f1801f3a">drpttracer_create_handle</a> (IN void *drcontext, IN <a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5">drpttracer_tracing_mode_t</a> tracing_mode, IN uint pt_size_shift, IN uint sideband_size_shift, OUT void **tracer_handle)</td></tr>
<tr class="separator:a0df98e25ae870fddf34da980f1801f3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad80d0c63dadc4dac1d21d0caf662f2f9"><td class="memItemLeft" align="right" valign="top">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#ad80d0c63dadc4dac1d21d0caf662f2f9">drpttracer_destroy_handle</a> (IN void *drcontext, IN void *tracer_handle)</td></tr>
<tr class="separator:ad80d0c63dadc4dac1d21d0caf662f2f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb2c6fe798b7b3125647d647fb8e7835"><td class="memItemLeft" align="right" valign="top">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#afb2c6fe798b7b3125647d647fb8e7835">drpttracer_start_tracing</a> (IN void *drcontext, IN void *tracer_handle)</td></tr>
<tr class="separator:afb2c6fe798b7b3125647d647fb8e7835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75d42188aac044aef56517160b355433"><td class="memItemLeft" align="right" valign="top">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#a75d42188aac044aef56517160b355433">drpttracer_stop_tracing</a> (IN void *drcontext, IN void *tracer_handle, OUT <a class="el" href="drpttracer_8h.html#a2a039aa7d15f79edcbae537289181000">drpttracer_output_t</a> **output)</td></tr>
<tr class="separator:a75d42188aac044aef56517160b355433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6722673d8102754af9c4284f76bc2acf"><td class="memItemLeft" align="right" valign="top">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="drpttracer_8h.html#a6722673d8102754af9c4284f76bc2acf">drpttracer_destroy_output</a> (IN void *drcontext, IN <a class="el" href="drpttracer_8h.html#a2a039aa7d15f79edcbae537289181000">drpttracer_output_t</a> *output)</td></tr>
<tr class="separator:a6722673d8102754af9c4284f76bc2acf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header for DynamoRIO Intel PT Tracing Extension. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a2a039aa7d15f79edcbae537289181000"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a039aa7d15f79edcbae537289181000">&#9670;&nbsp;</a></span>drpttracer_output_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__drpttracer__output__t.html">_drpttracer_output_t</a> <a class="el" href="drpttracer_8h.html#a2a039aa7d15f79edcbae537289181000">drpttracer_output_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The storage container type of drpttracer's output. This data struct is used by drpttracer to store PT metadata, PT trace, and sideband data. These data can be dumped into different files by the client. These files can be the inputs of <a class="el" href="classpt2ir__t.html">pt2ir_t</a>, which decodes the PT data into Dynamorio's IR. </p>

</div>
</div>
<a id="adf5b364ce02f7edc31dad432b6a7d59b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf5b364ce02f7edc31dad432b6a7d59b">&#9670;&nbsp;</a></span>pt_metadata_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__pt__metadata__t.html">_pt_metadata_t</a> <a class="el" href="drpttracer_8h.html#adf5b364ce02f7edc31dad432b6a7d59b">pt_metadata_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The type of PT trace's metadata.</p>
<dl class="section note"><dt>Note</dt><dd>drpttracer uses the cpuid instruction to get the cpu_family, cpu_model and cpu_stepping. The cpu_family, cpu_model and cpu_stepping are used to initialize the PT config of <a class="el" href="classpt2ir__t.html">pt2ir_t</a> when decoding a PT trace.</dd>
<dd>
drpttracer gets the time_shift, time_mult and time_zero from the opened perf event file's head. The time_shift, time_mult and time_zero are used to initialize the PT sideband config of <a class="el" href="classpt2ir__t.html">pt2ir_t</a> when decoding a PT trace. </dd></dl>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a7846187879de367e706edaed0293e45d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7846187879de367e706edaed0293e45d">&#9670;&nbsp;</a></span>drpttracer_status_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Success code for each drpttracer operation. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45daa8ba0cc1895bd5e2fbfa143c0c109bf2"></a>DRPTTRACER_SUCCESS&#160;</td><td class="fielddoc"><p>Operation succeeded. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45dab4d57a690dd5247bd71b0d0adfa67ecb"></a>DRPTTRACER_ERROR&#160;</td><td class="fielddoc"><p>Operation failed. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45da567c1101168271a76a7b57ad55bdba36"></a>DRPTTRACER_ERROR_INVALID_PARAMETER&#160;</td><td class="fielddoc"><p>Operation failed: invalid parameter. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45dab09a7ff2105b8eb3b46317c253ec5e8d"></a>DRPTTRACER_ERROR_FAILED_TO_OPEN_PERF_EVENT&#160;</td><td class="fielddoc"><p>Operation failed: failed to open perf event. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45da036841364a0e53fba420bed52ee1c5f0"></a>DRPTTRACER_ERROR_FAILED_TO_MMAP_PERF_DATA&#160;</td><td class="fielddoc"><p>Operation failed: failed to mmap perf data. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45dac4d8cf608e4e2a7d6f197250bd2df691"></a>DRPTTRACER_ERROR_FAILED_TO_MMAP_PT_DATA&#160;</td><td class="fielddoc"><p>Operation failed: failed to mmap PT data. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45da5810bfac6ed2c2b271e17ca1661b8bae"></a>DRPTTRACER_ERROR_FAILED_TO_START_TRACING&#160;</td><td class="fielddoc"><p>Operation failed: failed to start tracing. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45dad3df38fd5acea95b31071a5cc33d8a41"></a>DRPTTRACER_ERROR_FAILED_TO_STOP_TRACING&#160;</td><td class="fielddoc"><p>Operation failed: failed to stop tracing. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45dac3626cf9c2740a80ca15c99e6fba493a"></a>DRPTTRACER_ERROR_OVERWRITTEN_PT_TRACE&#160;</td><td class="fielddoc"><p>Operation failed: overwritten PT trace. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45da178ccc3073b124e34ba2542ac7514061"></a>DRPTTRACER_ERROR_FAILED_TO_READ_PT_DATA&#160;</td><td class="fielddoc"><p>Operation failed: failed to read PT data from PT ring buffer. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45da3beefda8ad4ea9aa597f6a07053c56af"></a>DRPTTRACER_ERROR_OVERWRITTEN_SIDEBAND_DATA&#160;</td><td class="fielddoc"><p>Operation failed: overwritten sideband data. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7846187879de367e706edaed0293e45da6cf6c48b7fa9c81b83444d022ac34308"></a>DRPTTRACER_ERROR_FAILED_TO_READ_SIDEBAND_DATA&#160;</td><td class="fielddoc"><p>Operation failed: failed to read SIDEBAND data from perf data ring buffer. </p>
</td></tr>
</table>

</div>
</div>
<a id="ab099a83052a5a8b244083b57ddffcbc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab099a83052a5a8b244083b57ddffcbc5">&#9670;&nbsp;</a></span>drpttracer_tracing_mode_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5">drpttracer_tracing_mode_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The tracing modes for <a class="el" href="drpttracer_8h.html#afb2c6fe798b7b3125647d647fb8e7835">drpttracer_start_tracing()</a>.</p>
<p>XXX: The <a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5a2a5a1e4a865cb2c334cf8419b2ec56fa">DRPTTRACER_TRACING_ONLY_USER</a> and <a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5a9d97d6e409ada6de57b31fe55aa0e4db">DRPTTRACER_TRACING_USER_AND_KERNEL</a> modes are not completely supported yet. The sideband data collected in these two modes do not include the initial mmap2 event recording. Therefore, if the user uses <a class="el" href="classpt2ir__t.html">pt2ir_t</a> in sideband converter mode, <a class="el" href="classpt2ir__t.html">pt2ir_t</a> cannot find the image and cannot decode the PT trace. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ab099a83052a5a8b244083b57ddffcbc5a2a5a1e4a865cb2c334cf8419b2ec56fa"></a>DRPTTRACER_TRACING_ONLY_USER&#160;</td><td class="fielddoc"><p>Trace only userspace instructions. </p>
</td></tr>
<tr><td class="fieldname"><a id="ab099a83052a5a8b244083b57ddffcbc5a567592a17aff204f5a4b194f66eaed0a"></a>DRPTTRACER_TRACING_ONLY_KERNEL&#160;</td><td class="fielddoc"><p>Trace only kernel instructions. </p>
</td></tr>
<tr><td class="fieldname"><a id="ab099a83052a5a8b244083b57ddffcbc5a9d97d6e409ada6de57b31fe55aa0e4db"></a>DRPTTRACER_TRACING_USER_AND_KERNEL&#160;</td><td class="fielddoc"><p>Trace both userspace and kernel instructions. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0df98e25ae870fddf34da980f1801f3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0df98e25ae870fddf34da980f1801f3a">&#9670;&nbsp;</a></span>drpttracer_create_handle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a> drpttracer_create_handle </td>
          <td>(</td>
          <td class="paramtype">IN void *&#160;</td>
          <td class="paramname"><em>drcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN <a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5">drpttracer_tracing_mode_t</a>&#160;</td>
          <td class="paramname"><em>tracing_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN uint&#160;</td>
          <td class="paramname"><em>pt_size_shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN uint&#160;</td>
          <td class="paramname"><em>sideband_size_shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT void **&#160;</td>
          <td class="paramname"><em>tracer_handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a pttracer handle. Must be called after <a class="el" href="drpttracer_8h.html#a2ce2d81e3de5e6969eb2742f1eab15d2">drpttracer_init()</a> and before <a class="el" href="drpttracer_8h.html#a85f7b141497601e4205789e490ca3535">drpttracer_exit()</a>. The handle is used to start and stop PT tracing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drcontext</td><td>The context of DynamoRIO. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tracing_mode</td><td>The tracing mode. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pt_size_shift</td><td>The size shift of PT trace's buffer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sideband_size_shift</td><td>The size shift of sideband data's buffer. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tracer_handle</td><td>The pttracer handle.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The size offset is used to control the size of the buffer allocated by the perf: sizeof(PT trace's buffer) = 2 ^ pt_size_shift * PAGE_SIZE. sizeof(Sideband data's buffer) = 2 ^ sideband_size_shift * PAGE_SIZE. Additionally, perf sets the buffer size to 4MiB by default. Therefore, when the client uses drpttracer to trace, it is best to set the trace and sideband buffer larger than 4Mib.</dd>
<dd>
The client must ensure that the buffer is large enough to hold the PT data. Insufficient buffer size will lead to lost data, which may cause issues in <a class="el" href="classpt2ir__t.html">pt2ir_t</a> decoding. If we detect an overflow, <a class="el" href="drpttracer_8h.html#a75d42188aac044aef56517160b355433">drpttracer_stop_tracing()</a> will return an error code <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45dac3626cf9c2740a80ca15c99e6fba493a">DRPTTRACER_ERROR_OVERWRITTEN_PT_TRACE</a> or <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45da3beefda8ad4ea9aa597f6a07053c56af">DRPTTRACER_ERROR_OVERWRITTEN_SIDEBAND_DATA</a>.</dd>
<dd>
Each thread corresponds to a trace handle. When calling <a class="el" href="drpttracer_8h.html#a0df98e25ae870fddf34da980f1801f3a">drpttracer_create_handle()</a>, the client will get a tracer_handle. The client can start and stop tracing by passing it to <a class="el" href="drpttracer_8h.html#afb2c6fe798b7b3125647d647fb8e7835">drpttracer_start_tracing()</a> and <a class="el" href="drpttracer_8h.html#a75d42188aac044aef56517160b355433">drpttracer_stop_tracing()</a>. And if the thread hold a tracer_handle, the client needs to call <a class="el" href="drpttracer_8h.html#ad80d0c63dadc4dac1d21d0caf662f2f9">drpttracer_destroy_handle()</a> to destroy the corresponding tracer_handle and release the resources before the thread end.</dd>
<dd>
For one thread, only one tracing can execute at the same time. So the client needs to ensure one thread only owns one pttracer handle.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>the status code. </dd></dl>

</div>
</div>
<a id="ad80d0c63dadc4dac1d21d0caf662f2f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad80d0c63dadc4dac1d21d0caf662f2f9">&#9670;&nbsp;</a></span>drpttracer_destroy_handle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a> drpttracer_destroy_handle </td>
          <td>(</td>
          <td class="paramtype">IN void *&#160;</td>
          <td class="paramname"><em>drcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN void *&#160;</td>
          <td class="paramname"><em>tracer_handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroy a pttracer handle and release the resources. Must be called after <a class="el" href="drpttracer_8h.html#a2ce2d81e3de5e6969eb2742f1eab15d2">drpttracer_init()</a> and before <a class="el" href="drpttracer_8h.html#a85f7b141497601e4205789e490ca3535">drpttracer_exit()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drcontext</td><td>The context of DynamoRIO. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tracer_handle</td><td>The pttracer handle.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the status code. </dd></dl>

</div>
</div>
<a id="a6722673d8102754af9c4284f76bc2acf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6722673d8102754af9c4284f76bc2acf">&#9670;&nbsp;</a></span>drpttracer_destroy_output()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a> drpttracer_destroy_output </td>
          <td>(</td>
          <td class="paramtype">IN void *&#160;</td>
          <td class="paramname"><em>drcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN <a class="el" href="drpttracer_8h.html#a2a039aa7d15f79edcbae537289181000">drpttracer_output_t</a> *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroys an output object of drpttracer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drcontext</td><td>The context of DynamoRIO. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">output</td><td>The output object that will be destroyed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the status code. </dd></dl>

</div>
</div>
<a id="a85f7b141497601e4205789e490ca3535"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85f7b141497601e4205789e490ca3535">&#9670;&nbsp;</a></span>drpttracer_exit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DR_EXPORT void drpttracer_exit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Cleans up the drpttracer extension. </p>

</div>
</div>
<a id="a2ce2d81e3de5e6969eb2742f1eab15d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ce2d81e3de5e6969eb2742f1eab15d2">&#9670;&nbsp;</a></span>drpttracer_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DR_EXPORT bool drpttracer_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initializes the drpttracer extension. Must be called prior to any of the other routines. Can be called multiple times (by separate components, normally) but each call must be paired with a corresponding call to <a class="el" href="drpttracer_8h.html#a85f7b141497601e4205789e490ca3535">drpttracer_exit()</a>.</p>
<dl class="section return"><dt>Returns</dt><dd>whether successful. </dd></dl>

</div>
</div>
<a id="afb2c6fe798b7b3125647d647fb8e7835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb2c6fe798b7b3125647d647fb8e7835">&#9670;&nbsp;</a></span>drpttracer_start_tracing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a> drpttracer_start_tracing </td>
          <td>(</td>
          <td class="paramtype">IN void *&#160;</td>
          <td class="paramname"><em>drcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN void *&#160;</td>
          <td class="paramname"><em>tracer_handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start a PT tracing session. Must pass a valid pttracer handle to this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drcontext</td><td>The context of DynamoRIO. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tracer_handle</td><td>The pttracer handle.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the status code. </dd></dl>

</div>
</div>
<a id="a75d42188aac044aef56517160b355433"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75d42188aac044aef56517160b355433">&#9670;&nbsp;</a></span>drpttracer_stop_tracing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DR_EXPORT <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45d">drpttracer_status_t</a> drpttracer_stop_tracing </td>
          <td>(</td>
          <td class="paramtype">IN void *&#160;</td>
          <td class="paramname"><em>drcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN void *&#160;</td>
          <td class="paramname"><em>tracer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT <a class="el" href="drpttracer_8h.html#a2a039aa7d15f79edcbae537289181000">drpttracer_output_t</a> **&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stops a PT tracing session. Must pass a valid pttracer handle to this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drcontext</td><td>The context of DynamoRIO. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tracer_handle</td><td>The pttracer handle. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">output</td><td>The output of PT tracing. This function will allocate and fill this output. It will copy the PT trace to the pt_buf of the output. When the tracing mode is <a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5a2a5a1e4a865cb2c334cf8419b2ec56fa">DRPTTRACER_TRACING_ONLY_USER</a> or <a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5a9d97d6e409ada6de57b31fe55aa0e4db">DRPTTRACER_TRACING_USER_AND_KERNEL</a>, the PT sideband data will be copied to the sideband_buf of the output. When the tracing mode is <a class="el" href="drpttracer_8h.html#ab099a83052a5a8b244083b57ddffcbc5a567592a17aff204f5a4b194f66eaed0a">DRPTTRACER_TRACING_ONLY_KERNEL</a>, it will not copy the sideband data to the buffer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>If the buffer size that was set in <a class="el" href="drpttracer_8h.html#afb2c6fe798b7b3125647d647fb8e7835">drpttracer_start_tracing()</a> is not enough, this function will return an error status code:<ul>
<li>Return <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45dac3626cf9c2740a80ca15c99e6fba493a">DRPTTRACER_ERROR_OVERWRITTEN_PT_TRACE</a> if the PT trace is overwritten.</li>
<li>Return <a class="el" href="drpttracer_8h.html#a7846187879de367e706edaed0293e45da3beefda8ad4ea9aa597f6a07053c56af">DRPTTRACER_ERROR_OVERWRITTEN_SIDEBAND_DATA</a> if the sideband data is overwritten.</li>
</ul>
</dd>
<dd>
The client can dump the output data to files. After online tracing is done, <a class="el" href="classpt2ir__t.html">pt2ir_t</a> can use these files to decode the online PT trace.</dd>
<dd>
The client doesn't need to allocate the output object, but it needs to free the output object using <a class="el" href="drpttracer_8h.html#a6722673d8102754af9c4284f76bc2acf">drpttracer_destroy_output()</a>.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>the status code. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.19-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_31cedd4509e06940f559c1ca2f722e02.html">ext</a></li><li class="navelem"><a class="el" href="dir_25f9aefd028883a4c211de7a83352cae.html">drpttracer</a></li><li class="navelem"><a class="el" href="drpttracer_8h.html">drpttracer.h</a></li>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.19314 --- Sat Nov 19 2022 03:14:15 &nbsp; <img border=0 src="favicon.png">
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
